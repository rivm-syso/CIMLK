<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<alignment xmlns="http://www.esdi-humboldt.eu/hale/alignment">
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="C5ccd5feb-4a02-4f40-80a8-1b0b7d149ca4" priority="highest">
        <source>
            <class>
                <type name="StalType" ns="http://cimlk.nl/1.0"/>
            </class>
        </source>
        <target>
            <class>
                <type name="StalType" ns="http://cimlk.nl/1.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
withTransformationContext{&#xD;
	def c = _.context.collector(it)&#xD;
	c.stalIdentificatie[_source.p.id.value()] = _source.p.identificatie.NEN3610ID.lokaalID.value().substring(2)&#xD;
	c.stalLengte[_source.p.id.value()] = _source.p.lengte.value()&#xD;
	c.stalBreedte[_source.p.id.value()] = _source.p.breedte.value()&#xD;
	c.stalHoogte[_source.p.id.value()] = _source.p.hoogte.value()&#xD;
	c.stalOrientatie[_source.p.id.value()] = _source.p.orientatie.value()&#xD;
	c.stalIdentificatiePandBAG[_source.p.id.value()] = _source.p.identificatiePandBAG.value()&#xD;
	c.stalX[_source.p.id.value()] = _source.p.geometrie.Point.pos.value()[0]&#xD;
	c.stalY[_source.p.id.value()] = _source.p.geometrie.Point.pos.value()[1]&#xD;
	String veehouderijhref = _source.p.veehouderij.href.value()&#xD;
	String veehouderijid = veehouderijhref.substring(1)&#xD;
	c.veehouderijIdentificatie[_source.p.id.value()] = veehouderijid&#xD;
	c.veehouderijId[_source.p.id.value()] = veehouderijid.substring(10)&#xD;
}&#xD;
&#xD;

</core:text>
        </complexParameter>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="C0042928f-9ae1-4fab-ab46-65d37f3670a0" priority="highest">
        <source>
            <class>
                <type name="VeehouderijType" ns="http://cimlk.nl/1.0"/>
            </class>
        </source>
        <target>
            <class>
                <type name="VeehouderijType" ns="http://cimlk.nl/1.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
withTransformationContext{&#xD;
	def c = _.context.collector(it)&#xD;
	c.veehouderijAdres[_source.p.id.value()] = _source.p.adres.value()&#xD;
	c.veehouderijDatumVergunning[_source.p.id.value()] = _source.p.datumVergunning.value()&#xD;
	_log.info('PUT ' + _source.p.id.value() + '=' + _source.p.datumVergunning.value())&#xD;
}
</core:text>
        </complexParameter>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="C035d45a8-b1da-43dc-950c-69d18b427978" priority="lowest">
        <source>
            <class>
                <type name="VeehouderijbronType" ns="http://cimlk.nl/1.0"/>
            </class>
        </source>
        <target>
            <class>
                <type name="veehouderij_bronnen"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def c = _.context.collector()&#xD;
&#xD;
_source.p.emissiespecificaties.each { maatregel -&gt;&#xD;
	_target {&#xD;
		bronX(_source.p.geometrie.Point.pos.value()[0])&#xD;
		bronY(_source.p.geometrie.Point.pos.value()[1])&#xD;
		bronHoogte(_source.p.hoogte.value())&#xD;
		bronDiameter(_source.p.diameter.value())&#xD;
		bronUittreesnelheid(_source.p.uittreesnelheid.value())&#xD;
		tijdstipRegistratie(_source.p.tijdstipRegistratie.value())&#xD;
		bronIdentificatie(_source.p.identificatie.NEN3610ID.lokaalID.value().substring(2))&#xD;
		aantalDieren(maatregel.p.Emissiespecificatie.aantalDieren.value())&#xD;
		emissiefactorPM10(maatregel.p.Emissiespecificatie.eigenEmissiefactorPm10.value())&#xD;
		reductiefactorPM10(maatregel.p.Emissiespecificatie.eigenReductiefactorPm10.value())&#xD;
		eigenFactorToelichting(maatregel.p.Emissiespecificatie.eigenFactorToelichting.value())&#xD;
		opmerking(maatregel.p.Emissiespecificatie.opmerking.value())&#xD;
		ravFactor(maatregel.p.Emissiespecificatie.huisvestingssysteem.href.value())&#xD;
		ravMaatregel(maatregel.p.Emissiespecificatie.aanvullendeTechniek.href.value())&#xD;
		String stalhref = _source.p.stal.href.value()&#xD;
		String stalid = stalhref.substring(1)&#xD;
		stalIdentificatie(c.stalIdentificatie[stalid].value())&#xD;
		stalHoogte(c.stalHoogte[stalid].value())&#xD;
		stalBreedte(c.stalBreedte[stalid].value())&#xD;
		stalLengte(c.stalLengte[stalid].value())&#xD;
		stalOrientatie(c.stalOrientatie[stalid].value())&#xD;
		stalIdentificatiePandBAG(c.stalIdentificatiePandBAG[stalid].value())&#xD;
		stalX(c.stalX[stalid].value())&#xD;
		stalY(c.stalY[stalid].value())&#xD;
		veehouderijIdentificatie(c.veehouderijId[stalid].value())&#xD;
		String veehouderijidentificatie = c.veehouderijIdentificatie[stalid].value()&#xD;
		veehouderijAdres(c.veehouderijAdres[veehouderijidentificatie].value())&#xD;
		veehouderijDatumVergunning(c.veehouderijDatumVergunning[veehouderijidentificatie].value())&#xD;
	}&#xD;
}
</core:text>
        </complexParameter>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.formattedstring" id="C8dfa4b13-c660-42fa-b59b-2c44c8cb52af" priority="normal">
        <source name="var">
            <property>
                <type name="VeehouderijType" ns="http://cimlk.nl/1.0"/>
                <child name="identificatie" ns="http://cimlk.nl/1.0"/>
                <child name="NEN3610ID" ns="http://cimlk.nl/1.0"/>
                <child name="lokaalID" ns="http://cimlk.nl/1.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="veehouderij_bronnen"/>
                <child name="veehouderijIdentificatie"/>
            </property>
        </target>
        <parameter value="{lokaalID}" name="pattern"/>
    </cell>
</alignment>
